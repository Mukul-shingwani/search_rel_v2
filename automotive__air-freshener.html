<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Search Assortment — automotive / air_freshener</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Fonts: Proxima Nova if installed, else Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- DataTables + Buttons -->
  <link rel="stylesheet" href="https://cdn.datatables.net/v/bs5/dt-2.0.3/b-3.0.1/fh-4.0.1/r-3.0.1/datatables.min.css"/>

  <style>
    :root {
      --bg: #0f1220;
      --card: #141a2a;
      --card-2: #181e31;
      --text: #f3f6ff;
      --text-dim: #b8c1d9;
      --border: #252c42;
      --brand: #7aa2ff;
      --brand-soft: #1a2340;
      --card-radius: 14px;
    }
    * { font-family: "Proxima Nova", Inter, "Segoe UI", Roboto, system-ui, -apple-system, Arial, sans-serif; }
    html, body { background: var(--bg); color: var(--text); }

    .page-header {
      background: radial-gradient(1200px 400px at 10% -10%, rgba(122,162,255,.25), transparent),
                  linear-gradient(90deg, var(--brand-soft), rgba(10,14,25,0.6));
      border-bottom: 1px solid var(--border);
    }
    .page-header h2 { font-weight: 700; letter-spacing:.2px; color: var(--text); }
    .muted { color: var(--text-dim); }

    .btn, .btn:focus, .btn:active { box-shadow:none; }
    .btn-outline-secondary { color: var(--text); border-color: var(--border); }
    .btn-outline-secondary:hover { background: var(--card-2); border-color: var(--border); }
    .btn-outline-primary { color: var(--text); border-color: var(--brand); }
    .btn-outline-primary:hover { background: rgba(122,162,255,.12); }

    .section-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--card-radius);
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      padding: 1rem 1.1rem 1.25rem 1.1rem;
      height: 100%;
      contain: content;
      color: var(--text);
    }
    .section-title { font-weight: 700; font-size: 1.05rem; margin-bottom:.6rem; color: var(--text); }

    /* Executive summary pills */
    .summary-pill {
      border-radius: 999px;
      padding:.7rem 1.1rem;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border);
      display:inline-flex; gap:.6rem; align-items:center;
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
      margin:.3rem .6rem .3rem 0;
    }
    .summary-pill .label { color: var(--text-dim); font-size:.9rem; }
    .summary-pill .value { font-weight:700; color: var(--text); font-size:1.05rem; }

    /* DataTables dark theme */
    table.dataTable { table-layout: fixed; color: var(--text); }
    table.table {
      --bs-table-color: var(--text);
      --bs-table-bg: transparent;
      --bs-table-striped-color: var(--text);
      --bs-table-hover-color: var(--text);
      --bs-table-border-color: var(--border);
      --bs-table-striped-bg: rgba(255,255,255,0.06);
      --bs-table-hover-bg: rgba(255,255,255,0.08);
    }
    /* Center headers horizontally + vertically */
    table.dataTable thead th {
      background: var(--card-2) !important;
      border-bottom: 1px solid var(--border) !important;
      color: var(--text) !important;
      text-align: center !important;
      vertical-align: middle !important;
    }
    /* Center body cells horizontally + vertically by default */
    table.dataTable tbody td {
      border-color: var(--border);
      color: var(--text);
      text-align: center;
      vertical-align: middle;
    }
    /* Override DataTables' numeric right-align helpers */
    table.dataTable td.dt-type-numeric,
    table.dataTable th.dt-type-numeric,
    table.dataTable td.dt-right,
    table.dataTable th.dt-right,
    table.dataTable td.dt-body-right,
    table.dataTable th.dt-head-right {
      text-align: center !important;
    }

    /* Inputs */
    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_length label,
    .dataTables_wrapper .dataTables_filter label { color: var(--text-dim); }
    .dataTables_wrapper .dataTables_filter input,
    .dataTables_wrapper .dataTables_length select {
      background: var(--card-2);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .dataTables_wrapper .dataTables_filter input::placeholder { color: var(--text-dim); }

    /* Pagination */
    .dataTables_wrapper .dataTables_paginate .paginate_button {
      color: var(--text) !important; border-color: var(--border) !important;
      background: transparent !important;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      background: var(--brand-soft) !important; border-color: var(--border) !important; color: var(--text) !important;
    }

    a, a:visited { color: var(--brand); }
    a:hover { color: #aecdff; }

    /* Long text handling */
    .wrap-text { white-space: pre-wrap; line-height:1.35rem; color: var(--text); }

    /* Actionables block */
    .act {
      display: grid;
      grid-template-columns: 130px 1fr;
      align-items: center;
      column-gap: .8rem;
      background: var(--card-2); border: 1px solid var(--border);
      border-radius: 12px; padding:.65rem .8rem; color: var(--text);
      text-align: left;
    }
    .act .tag {
      justify-self: center;
      font-size:.72rem; font-weight:700; text-transform:uppercase;
      letter-spacing:.04em; color: var(--brand);
      padding:.22rem .55rem; border:1px solid var(--brand); border-radius:999px;
      background: rgba(122,162,255,.08);
    }
    .act .txt { color: var(--text); }

    /* Left-align ONLY the Actionables column */
    td.col-actionables, th.col-actionables {
      text-align: left !important;
      vertical-align: top !important;
    }

    /* PLP combined cell: stack links vertically */
    .plp-links a { display:block; line-height:1.2; margin-bottom:.25rem; }

    .footer-note { color: var(--text-dim); font-size:.85rem; }
  </style>
</head>

<body>
  <header class="page-header py-3">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-between">
        <div>
          <h2 class="mb-0">Search Assortment — automotive / air_freshener</h2>
          <div class="muted">Category: <strong>automotive</strong> &nbsp;|&nbsp; Subtype: <strong>air_freshener</strong></div>
        </div>
        <div class="text-end">
          <a class="btn btn-outline-secondary btn-sm" href="#" onclick="window.print()">Print</a>
        </div>
      </div>
    </div>
  </header>

  <main class="container my-4">

    <!-- Executive Summary -->
    <div class="section-card mb-4">
      <div class="d-flex align-items-center flex-wrap">
        <div class="summary-pill"><span class="label">Overall Score</span><span class="value" id="pill-score">—</span></div>
        <div class="summary-pill"><span class="label">Overall Search Hits</span><span class="value" id="pill-hits">—</span></div>
        <div class="summary-pill"><span class="label">Overall GMV Opportunity (L30D) </span><span class="value" id="pill-gmv">—</span></div>
        <div class="ms-auto muted">Generated on 16 Sep 2025, 04:25 PM</div>
      </div>
    </div>

    <!-- Keyword level insights -->
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="section-card">
          <div class="section-title">Keyword Insights — Generic</div>
          <table id="tbl-generic" class="table table-striped table-hover w-100"></table>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="section-card">
          <div class="section-title">Keyword Insights — Branded</div>
          <table id="tbl-branded" class="table table-striped table-hover w-100"></table>
        </div>
      </div>
    </div>

    <!-- Detailed analysis -->
    <div class="section-card mt-4">
      <div class="d-flex justify-content-between align-items-center">
        <div class="section-title mb-0">Detailed Analysis</div>
      </div>
      <p class="muted mb-2">Actionables per search term. Links open in a new tab.</p>
      <table id="tbl-detail" class="table table-striped table-hover w-100"></table>
    </div>

    <div class="my-4 footer-note">
      Data source: <code>noonbigmerchsandbox.puru.search_assortment_final_table_v9</code>. Report for <strong>automotive × air_freshener</strong>.
    </div>
  </main>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/v/bs5/dt-2.0.3/b-3.0.1/fh-4.0.1/r-3.0.1/datatables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
  const EXEC_SUMMARY = {"overall_score": 0.84, "overall_st_hits": 1387, "overall_gmv_oppt": 1055.51};
  const DATA_GENERIC = [{"search_term": "car air freshener spray", "performance": "Good (0.90)", "st_hits": 20, "st_gmv": 0.0, "outcome": 1}, {"search_term": "natural car air freshener", "performance": "Below Average (0.79)", "st_hits": 0, "st_gmv": 0.0, "outcome": 1}, {"search_term": "long lasting car air freshener", "performance": "Average (0.89)", "st_hits": 0, "st_gmv": 0.0, "outcome": 1}, {"search_term": "car air freshener", "performance": "Good (0.91)", "st_hits": 1318, "st_gmv": 710.9, "outcome": 0}, {"search_term": "scented car air freshener", "performance": "Average (0.90)", "st_hits": 0, "st_gmv": 0.0, "outcome": 1}];
  const DATA_BRANDED = [{"search_term": "california scents newport", "performance": "Below Average (0.76)", "st_hits": 1, "st_gmv": 0.0, "outcome": 1}, {"search_term": "aroma diffuser for car", "performance": "Excellent (0.97)", "st_hits": 1, "st_gmv": 0.0, "outcome": 0}, {"search_term": "exotica air freshener strawberry", "performance": "Good (0.94)", "st_hits": 1, "st_gmv": 0.0, "outcome": 0}, {"search_term": "yankee candle car air freshener", "performance": "Good (0.94)", "st_hits": 0, "st_gmv": 0.0, "outcome": 0}, {"search_term": "febreze car air freshener", "performance": "Below Average (0.75)", "st_hits": 1, "st_gmv": 0.0, "outcome": 1}, {"search_term": "air wick car air freshener", "performance": "Below Average (0.79)", "st_hits": 25, "st_gmv": 0.0, "outcome": 0}, {"search_term": "areon vanila black", "performance": "Below Average (0.83)", "st_hits": 1, "st_gmv": 0.0, "outcome": 0}, {"search_term": "exotica car freshener cherry", "performance": "Average (0.90)", "st_hits": 7, "st_gmv": 60.0, "outcome": 1}, {"search_term": "glade car air freshener", "performance": "Poor (0.61)", "st_hits": 12, "st_gmv": 64.01, "outcome": 0}, {"search_term": "little trees air freshener", "performance": "Below Average (0.82)", "st_hits": 0, "st_gmv": 0.0, "outcome": 0}];
  const DATA_DETAIL  = [{"search_term": "california scents newport", "brand_actionable": "California Scents appears prominently on both; Amazon shows 9 SKUs vs noon's 4 SKUs for this brand.", "assortment_actionable": "Noon lacks Newport scent variant, Amazon offers multiple Newport SKUs, showing better variety under the brand.", "overall_perception": "Noon ranks relevant California Scents but misses Newport scent, causing shopper confusion versus Amazon's focused results.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=california%20scents%20newport&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=california+scents+newport", "outcome": 1, "performance_tag": "Below Average", "st_hits": 1, "gmv_oppt": 1.5126769552368575}, {"search_term": "aroma diffuser for car", "brand_actionable": "brands missing on noon: Airversa, Bullsone, Unee. Present on noon: Joshberg, DMG TECH, SJet.", "assortment_actionable": "Noon offers diverse aroma diffuser variants with multiple capacities and features, matching keyword intent well.", "overall_perception": "Noon ranks relevant aroma diffusers prominently with minimal irrelevant products, supporting shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=aroma%20diffuser%20for%20car&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=aroma+diffuser+for+car", "outcome": 0, "performance_tag": "Excellent", "st_hits": 1, "gmv_oppt": 1.6317024238416111}, {"search_term": "exotica air freshener strawberry", "brand_actionable": "Exotica brand is fully covered on noon with 10 SKUs; Amazon shows similar but includes 'Exotica Scents'.", "assortment_actionable": "Noon offers diverse strawberry variants and packs under Exotica, matching keyword and subcategory well.", "overall_perception": "Noon ranks relevant Exotica strawberry air fresheners top, building shopper trust without irrelevant products.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=exotica%20air%20freshener%20strawberry&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=exotica+air+freshener+strawberry", "outcome": 0, "performance_tag": "Good", "st_hits": 1, "gmv_oppt": 0.6419118179814116}, {"search_term": "yankee candle car air freshener", "brand_actionable": "Yankee Candle appears prominently on both platforms; Amazon shows slightly more brand variants.", "assortment_actionable": "Both platforms show relevant Yankee Candle car air fresheners with good variant depth and scent diversity.", "overall_perception": "Noon ranks relevant Yankee Candle SKUs high, maintaining shopper trust without irrelevant products.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=yankee%20candle%20car%20air%20freshener&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=yankee+candle+car+air+freshener", "outcome": 0, "performance_tag": "Good", "st_hits": 0, "gmv_oppt": 0.0}, {"search_term": "febreze car air freshener", "brand_actionable": "Febreze appears prominently on both platforms; noon shows 5 Febreze SKUs vs Amazon's 9, indicating lower quantity on noon.", "assortment_actionable": "Noon includes irrelevant air purifiers, diluting assortment relevance; Amazon focuses solely on Febreze air fresheners with better variant variety.", "overall_perception": "Noon's ranking mixes relevant Febreze products with unrelated items, potentially confusing shoppers and weakening trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=febreze%20car%20air%20freshener&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=febreze+car+air+freshener", "outcome": 1, "performance_tag": "Below Average", "st_hits": 1, "gmv_oppt": 1.1763975821705897}, {"search_term": "air wick car air freshener", "brand_actionable": "Air Wick appears prominently on both with 10 SKUs on noon vs 7 on Amazon; noon lacks Godrej aer brand present on Amazon.", "assortment_actionable": "Noon offers good variety of Air Wick variants (sprays, gels, diffusers) matching keyword and subcategory well.", "overall_perception": "Noon ranks relevant Air Wick products highly with no irrelevant items, building shopper trust effectively.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=air%20wick%20car%20air%20freshener&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=air+wick+car+air+freshener", "outcome": 0, "performance_tag": "Below Average", "st_hits": 25, "gmv_oppt": 14.39864586753736}, {"search_term": "areon vanila black", "brand_actionable": "Areon appears prominently on both platforms; noon shows 10 SKUs vs Amazon's 10 SKUs, matching brand presence.", "assortment_actionable": "Noon offers diverse Areon Vanilla Black variants including car and home perfumes, matching keyword and category well.", "overall_perception": "Noon ranks relevant Areon Vanilla Black SKUs highly with no irrelevant products, building shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=areon%20vanila%20black&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=areon+vanila+black", "outcome": 0, "performance_tag": "Below Average", "st_hits": 1, "gmv_oppt": 0.8339291577832556}, {"search_term": "exotica car freshener cherry", "brand_actionable": "Exotica brand appears prominently on both; Amazon shows additional Exotica Scents and California Scents variants.", "assortment_actionable": "Noon offers good variant depth but lacks other brands and scent variety present on Amazon.", "overall_perception": "Noon ranks relevant Exotica Cherry products well but misses broader brand variety, limiting shopper choice.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=exotica%20car%20freshener%20cherry&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=exotica+car+freshener+cherry", "outcome": 1, "performance_tag": "Average", "st_hits": 7, "gmv_oppt": 60.001305}, {"search_term": "glade car air freshener", "brand_actionable": "Glade appears prominently on both platforms with similar SKU counts; noon matches Amazon's brand presence well.", "assortment_actionable": "Noon offers diverse Glade variants including sprays, holders, and refills, matching keyword and subcategory well.", "overall_perception": "Noon ranks relevant Glade car air fresheners highly with no irrelevant products, building shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=glade%20car%20air%20freshener&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=glade+car+air+freshener", "outcome": 0, "performance_tag": "Poor", "st_hits": 12, "gmv_oppt": 64.011392219}, {"search_term": "little trees air freshener", "brand_actionable": "Little Trees brand appears prominently on both platforms; noon shows 10 SKUs vs Amazon's 9, matching brand presence well.", "assortment_actionable": "Noon offers diverse Little Trees variants (sprays, vent wraps, clips), matching keyword and subcategory relevance accurately.", "overall_perception": "Noon ranks relevant Little Trees air fresheners top, no irrelevant products, supporting shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=little%20trees%20air%20freshener&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=little+trees+air+freshener", "outcome": 0, "performance_tag": "Below Average", "st_hits": 0, "gmv_oppt": 0.0}, {"search_term": "car air freshener spray", "brand_actionable": "brands missing on noon: Areon, Meguiar’s, Sonax, Little Trees, Armor All. Present on noon: Godrej, Glade, HERIOS.", "assortment_actionable": "Noon shows mixed air fresheners and some AC cleaners, reducing keyword relevance and assortment focus.", "overall_perception": "Noon ranks some irrelevant AC cleaners and diffusers high, confusing shopper intent for car air freshener spray.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=car%20air%20freshener%20spray&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=car+air+freshener+spray", "outcome": 1, "performance_tag": "Good", "st_hits": 20, "gmv_oppt": 16.383693063308467}, {"search_term": "natural car air freshener", "brand_actionable": "brands missing on noon: Mangalam, Paradise Air, Bullsone, Manoub. Present on noon: Serenova, SAMEILI, Fleur De Printemps.", "assortment_actionable": "Noon shows natural scent variants but lacks organic camphor and charcoal types seen on Amazon.", "overall_perception": "Noon ranks relevant natural air fresheners top but misses diverse organic options, slightly limiting shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=natural%20car%20air%20freshener&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=natural+car+air+freshener", "outcome": 1, "performance_tag": "Below Average", "st_hits": 0, "gmv_oppt": 0.0}, {"search_term": "long lasting car air freshener", "brand_actionable": "brands missing on noon: KOVI, Godrej, Meguiar, Areon. Present on noon: Generic, Fleur De Printemps, EXOTICA.", "assortment_actionable": "Noon shows good product variety and relevant long-lasting car air fresheners matching keyword intent.", "overall_perception": "Noon ranks relevant long-lasting air fresheners well, no visible irrelevant products causing confusion.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=long%20lasting%20car%20air%20freshener&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=long+lasting+car+air+freshener", "outcome": 1, "performance_tag": "Average", "st_hits": 0, "gmv_oppt": 0.0}, {"search_term": "car air freshener", "brand_actionable": "brands missing on noon: Llum, Involve Your Senses, California Scents, SKY-TOUCH, Home-Cloud, Bullsone. Present on noon: Godrej, Kovi, Serenova, DMG TECH.", "assortment_actionable": "Noon shows good variant depth and style range including gels, vent clips, diffusers, and solid fresheners under multiple brands.", "overall_perception": "Noon ranks relevant car air fresheners well with minimal irrelevant products, supporting shopper trust and clear search intent.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=car%20air%20freshener&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=car+air+freshener", "outcome": 0, "performance_tag": "Good", "st_hits": 1318, "gmv_oppt": 894.9194825808063}, {"search_term": "scented car air freshener", "brand_actionable": "brands missing on noon: Godrej, Air Wick, Glade. Present on noon: Generic, SJet, DMG TECH.", "assortment_actionable": "Noon shows diverse scented fresheners with variants; Amazon offers more branded variety but less diffuser types.", "overall_perception": "Noon ranks relevant scented air fresheners well, no visible irrelevant products, builds shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=scented%20car%20air%20freshener&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=scented+car+air+freshener", "outcome": 1, "performance_tag": "Average", "st_hits": 0, "gmv_oppt": 0.0}];

  const clean_text = (text) => term.replace(/ /g, '_')

  const linkToDetail = (term) => `<a class="kw-link" href=#${term.replace(/ /g, '_')}>${term}</a>`;

  const toNumber = (v) => {
    if (v === null || v === undefined) return NaN;
    if (typeof v === 'number') return v;
    if (typeof v === 'string') {
      const s = v.replace(/,/g, '').trim();
      return s === '' ? NaN : Number(s);
    }
    return NaN;
  };
  const fmtInt = (v) => Number.isFinite(toNumber(v)) ? toNumber(v).toLocaleString() : "—";
  const fmtNum = (v) =>
    Number.isFinite(toNumber(v))
      ? toNumber(v).toLocaleString(undefined, { minimumFractionDigits:0, maximumFractionDigits:2 })
      : "—";

  const toLink = (url, label) => {
    if (!url || typeof url !== 'string') return '';
    const safe = url.startsWith('http') ? url : null;
    return safe ? `<a href="${safe}" target="_blank" rel="noopener">${label || 'Open'}</a>` : '';
  };
  const escapeHTML = (s) =>
    String(s ?? '').replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);

  // Build single "Actionables" cell (no Show more / no clamping)
  const makeActionablesCell = (row) => {
    const items = [];
    if (row.brand_actionable) items.push(`<div class="act"><div class="tag">Brand</div><div class="txt wrap-text">${escapeHTML(row.brand_actionable)}</div></div>`);
    if (row.assortment_actionable) items.push(`<div class="act"><div class="tag">Assortment</div><div class="txt wrap-text">${escapeHTML(row.assortment_actionable)}</div></div>`);
    if (row.overall_perception) items.push(`<div class="act"><div class="tag">Perception</div><div class="txt wrap-text">${escapeHTML(row.overall_perception)}</div></div>`);
    const content = items.join('');
    return `<div class="cell-stack"><div class="wrap-text">${content}</div></div>`;
  };

  // Helper: pick GMV opportunity from available keys (gmv_oppt preferred)
  const pickGmvOppt = (row) => {
    const v = row.gmv_oppt ?? row.gmv_loss ?? row.gmv_opportunity ?? null;
    return v;
  };

  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('pill-score').textContent = EXEC_SUMMARY.overall_score ?? "—";
    document.getElementById('pill-hits').textContent  = fmtInt(EXEC_SUMMARY.overall_st_hits);
    document.getElementById('pill-gmv').textContent   = fmtNum(EXEC_SUMMARY.overall_gmv_oppt);

    // Generic table (center columns)
    $('#tbl-generic').DataTable({
      data: DATA_GENERIC,
      columns: [
        { title:'Search Term',     data:'search_term', className:'text-center align-middle', render:(d)=>linkToDetail(d)},
        { title:'Title Similarity',     data:'performance', className:'text-center align-middle' },
        { title:'Outcome',         data:'outcome',      className:'text-center align-middle', render:(d)=>escapeHTML(d ?? '—') },
        { title:'Search Hits',     data:'st_hits',     className:'text-center align-middle', render:(d)=>fmtInt(d) },
        { title:'Search Term GMV', data:'st_gmv',      className:'text-center align-middle', render:(d)=>fmtNum(d) }
      ],
      order: [[3,'desc']], responsive: true, fixedHeader: false, deferRender: true, autoWidth: false,
      pageLength: 10, lengthMenu: [10,25,50,100], dom:'Bfrtip', buttons:['pageLength','copy','csv']
    });

    // Branded table (center columns)
    $('#tbl-branded').DataTable({
      data: DATA_BRANDED,
      columns: [
        { title:'Search Term',     data:'search_term', className:'text-center align-middle', render:(d)=>linkToDetail(d) },
        { title:'Title Similarity',     data:'performance', className:'text-center align-middle' },
        { title:'Outcome',         data:'outcome',      className:'text-center align-middle', render:(d)=>escapeHTML(d ?? '—') },
        { title:'Search Hits',     data:'st_hits',     className:'text-center align-middle', render:(d)=>fmtInt(d) },
        { title:'Search Term GMV', data:'st_gmv',      className:'text-center align-middle', render:(d)=>fmtNum(d) }
      ],
      order: [[3,'desc']], responsive: true, fixedHeader: false, deferRender: true, autoWidth: false,
      pageLength: 10, lengthMenu: [10,25,50,100], dom:'Bfrtip', buttons:['pageLength','copy','csv']
    });

    // Detailed Analysis (center everything except Actionables)
    $('#tbl-detail').DataTable({
      data: DATA_DETAIL,
      columns: [
        { title:'Search Term',     data:'search_term',   width:'10%', className:'text-center align-middle' },
        { title:'Outcome',     data:'outcome',     width:'8%', className:'text-center align-middle', render:(d)=>escapeHTML(d ?? '—') },
        { title:'Insights',     data:null,            width:'54%', className:'col-actionables', render:(d,t,row)=>makeActionablesCell(row) },
        { title:'Hits',     data:'st_hits',       width:'8%', className:'text-center align-middle', render:(d)=>fmtInt(d) },
        { title:'GMV Oppt', data:null,            width:'10%', className:'text-center align-middle', render:(d,t,row)=>fmtNum(pickGmvOppt(row)) },
        { title:'PLP',             data:null,            width:'10%', className:'text-center align-middle',
        render:(d,t,row)=>{const parts = [];
          if (row.noon_plp_link)   parts.push(toLink(row.noon_plp_link,   'noon search results'));
          if (row.amazon_plp_link) parts.push(toLink(row.amazon_plp_link, 'Amazon search results'));
          return parts.length ? '<div class="plp-links">' + parts.join('') + '</div>' : '—';
        }
        }
      ],
      order: [[0,'asc']], responsive: false, fixedHeader: false, deferRender: true, autoWidth: false,
      pageLength: 15, lengthMenu: [15,25,50,100], dom:'Bfrtip', buttons:['pageLength','copy','csv'],
      rowId: (d) => d.search_term.replace(/ /g, '_')
    });
  });
  </script>
</body>
</html>
