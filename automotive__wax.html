<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Search Assortment — automotive / wax</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Fonts: Proxima Nova if installed, else Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- DataTables + Buttons -->
  <link rel="stylesheet" href="https://cdn.datatables.net/v/bs5/dt-2.0.3/b-3.0.1/fh-4.0.1/r-3.0.1/datatables.min.css"/>

  <style>
    :root {
      --bg: #0f1220;
      --card: #141a2a;
      --card-2: #181e31;
      --text: #f3f6ff;
      --text-dim: #b8c1d9;
      --border: #252c42;
      --brand: #7aa2ff;
      --brand-soft: #1a2340;
      --card-radius: 14px;
    }
    * { font-family: "Proxima Nova", Inter, "Segoe UI", Roboto, system-ui, -apple-system, Arial, sans-serif; }
    html, body { background: var(--bg); color: var(--text); }

    .page-header {
      background: radial-gradient(1200px 400px at 10% -10%, rgba(122,162,255,.25), transparent),
                  linear-gradient(90deg, var(--brand-soft), rgba(10,14,25,0.6));
      border-bottom: 1px solid var(--border);
    }
    .page-header h2 { font-weight: 700; letter-spacing:.2px; color: var(--text); }
    .muted { color: var(--text-dim); }

    .btn, .btn:focus, .btn:active { box-shadow:none; }
    .btn-outline-secondary { color: var(--text); border-color: var(--border); }
    .btn-outline-secondary:hover { background: var(--card-2); border-color: var(--border); }
    .btn-outline-primary { color: var(--text); border-color: var(--brand); }
    .btn-outline-primary:hover { background: rgba(122,162,255,.12); }

    .section-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--card-radius);
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      padding: 1rem 1.1rem 1.25rem 1.1rem;
      height: 100%;
      contain: content;
      color: var(--text);
    }
    .section-title { font-weight: 700; font-size: 1.05rem; margin-bottom:.6rem; color: var(--text); }

    /* Executive summary pills */
    .summary-pill {
      border-radius: 999px;
      padding:.7rem 1.1rem;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border);
      display:inline-flex; gap:.6rem; align-items:center;
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
      margin:.3rem .6rem .3rem 0;
    }
    .summary-pill .label { color: var(--text-dim); font-size:.9rem; }
    .summary-pill .value { font-weight:700; color: var(--text); font-size:1.05rem; }

    /* DataTables dark theme */
    table.dataTable { table-layout: fixed; color: var(--text); }
    table.table {
      --bs-table-color: var(--text);
      --bs-table-bg: transparent;
      --bs-table-striped-color: var(--text);
      --bs-table-hover-color: var(--text);
      --bs-table-border-color: var(--border);
      --bs-table-striped-bg: rgba(255,255,255,0.06);
      --bs-table-hover-bg: rgba(255,255,255,0.08);
    }
    /* Center headers horizontally + vertically */
    table.dataTable thead th {
      background: var(--card-2) !important;
      border-bottom: 1px solid var(--border) !important;
      color: var(--text) !important;
      text-align: center !important;
      vertical-align: middle !important;
    }
    /* Center body cells horizontally + vertically by default */
    table.dataTable tbody td {
      border-color: var(--border);
      color: var(--text);
      text-align: center;
      vertical-align: middle;
    }
    /* Override DataTables' numeric right-align helpers */
    table.dataTable td.dt-type-numeric,
    table.dataTable th.dt-type-numeric,
    table.dataTable td.dt-right,
    table.dataTable th.dt-right,
    table.dataTable td.dt-body-right,
    table.dataTable th.dt-head-right {
      text-align: center !important;
    }

    /* Inputs */
    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_length label,
    .dataTables_wrapper .dataTables_filter label { color: var(--text-dim); }
    .dataTables_wrapper .dataTables_filter input,
    .dataTables_wrapper .dataTables_length select {
      background: var(--card-2);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .dataTables_wrapper .dataTables_filter input::placeholder { color: var(--text-dim); }

    /* Pagination */
    .dataTables_wrapper .dataTables_paginate .paginate_button {
      color: var(--text) !important; border-color: var(--border) !important;
      background: transparent !important;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      background: var(--brand-soft) !important; border-color: var(--border) !important; color: var(--text) !important;
    }

    a, a:visited { color: var(--brand); }
    a:hover { color: #aecdff; }

    /* Long text handling */
    .wrap-text { white-space: pre-wrap; line-height:1.35rem; color: var(--text); }

    /* Actionables block */
    .act {
      display: grid;
      grid-template-columns: 130px 1fr;
      align-items: center;
      column-gap: .8rem;
      background: var(--card-2); border: 1px solid var(--border);
      border-radius: 12px; padding:.65rem .8rem; color: var(--text);
      text-align: left;
    }
    .act .tag {
      justify-self: center;
      font-size:.72rem; font-weight:700; text-transform:uppercase;
      letter-spacing:.04em; color: var(--brand);
      padding:.22rem .55rem; border:1px solid var(--brand); border-radius:999px;
      background: rgba(122,162,255,.08);
    }
    .act .txt { color: var(--text); }

    /* Left-align ONLY the Actionables column */
    td.col-actionables, th.col-actionables {
      text-align: left !important;
      vertical-align: top !important;
    }

    /* PLP combined cell: stack links vertically */
    .plp-links a { display:block; line-height:1.2; margin-bottom:.25rem; }

    .footer-note { color: var(--text-dim); font-size:.85rem; }

    /* Filter dropdown styling */
    .filter-bar {
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      align-items: center;
    }
  </style>
</head>

<body>
  <header class="page-header py-3">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-between">
        <div>
          <h2 class="mb-0">Search Assortment — automotive / wax</h2>
          <div class="muted">Category: <strong>automotive</strong> &nbsp;|&nbsp; Subtype: <strong>wax</strong></div>
        </div>
        <div class="text-end">
          <a class="btn btn-outline-secondary btn-sm" href="#" onclick="window.print()">Print</a>
        </div>
      </div>
    </div>
  </header>

  <main class="container my-4">

    <!-- Executive Summary -->
    <div class="section-card mb-4">
      <div class="d-flex align-items-center flex-wrap">
        <div class="summary-pill"><span class="label">Category GMV (AED, L30D)</span><span class="value" id="pill-score">—</span></div>
        <div class="summary-pill"><span class="label">Overall Est. Search Hits (L30D)</span><span class="value" id="pill-hits">—</span></div>
        <div class="summary-pill"><span class="label">Overall Est. GMV Opportunity (AED, L30D) </span><span class="value" id="pill-gmv">—</span></div>
        <div class="muted text-start" style="font-size:0.72em;">Results compare the top 15 products from noon and Amazon. Some brands marked as missing may appear lower 
        on noon but are present in Amazon's top 15. Est. potential GMV is estimated based on ideal search hits share on the keywords (given an ideal assortment), 
        category average conversion and Amazon's average offer price</div>
      </div>
    </div>

    <!-- Keyword level insights -->
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="section-card">
          <div class="section-title">Keyword Insights — Generic</div>
          <table id="tbl-generic" class="table table-striped table-hover w-100"></table>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="section-card">
          <div class="section-title">Keyword Insights — Branded</div>
          <table id="tbl-branded" class="table table-striped table-hover w-100"></table>
        </div>
      </div>
    </div>

    <!-- Detailed analysis -->
    <div class="section-card mt-4">
      <div class="d-flex justify-content-between align-items-center">
        <div class="section-title mb-0">Detailed Analysis</div>
      </div>
      <p class="muted mb-2">Actionables per search term. B1 refers to priority for branded keywords, and G1 for generic</p>
      <table id="tbl-detail" class="table table-striped table-hover w-100"></table>
    </div>

    <div class="my-4 footer-note">
      Data source: <code>noonbigmerchsandbox.satyam.search_assortment_eval_final_draft3</code>. Report for <strong>automotive × wax</strong>. Generated on : <strong>23 Sep 2025, 07:24 PM</strong>
    </div>
  </main>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/v/bs5/dt-2.0.3/b-3.0.1/fh-4.0.1/r-3.0.1/datatables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <script>
    const EXEC_SUMMARY = {"overall_score": 4528.0, "overall_st_hits": 2794, "overall_gmv_oppt": 2744.0};
    const DATA_GENERIC = [{"search_term": "car wax", "performance": "Below Average (0.82)", "st_hits": 693, "gmv_oppt": 620.0, "outcome": 1, "express_share": 0.93, "filter_tag": "G1"}, {"search_term": "liquid car wax", "performance": "Good (0.92)", "st_hits": 139, "gmv_oppt": 133.0, "outcome": 2, "express_share": 1.0, "filter_tag": "G2"}, {"search_term": "premium car wax 500ml", "performance": "Good (0.92)", "st_hits": 46, "gmv_oppt": 38.0, "outcome": 4, "express_share": 0.43, "filter_tag": "G4"}, {"search_term": "carnauba wax", "performance": "Excellent (0.95)", "st_hits": 92, "gmv_oppt": 95.0, "outcome": 3, "express_share": 0.93, "filter_tag": "G3"}, {"search_term": "car wax for scratches", "performance": "Average (0.89)", "st_hits": 231, "gmv_oppt": 161.0, "outcome": 5, "express_share": 1.0, "filter_tag": "G5"}];
    const DATA_BRANDED = [{"search_term": "sonax car wax", "performance": "Below Average (0.81)", "st_hits": 139, "gmv_oppt": 136.0, "outcome": 9, "express_share": 1.0, "filter_tag": "B9"}, {"search_term": "simoniz car wax", "performance": "Below Average (0.83)", "st_hits": 46, "gmv_oppt": 39.0, "outcome": 8, "express_share": 0.33, "filter_tag": "B8"}, {"search_term": "formula1 car wax", "performance": "Good (0.91)", "st_hits": 162, "gmv_oppt": 145.0, "outcome": 10, "express_share": 0.93, "filter_tag": "B10"}, {"search_term": "liquimoly car wax", "performance": "Below Average (0.82)", "st_hits": 115, "gmv_oppt": 101.0, "outcome": 6, "express_share": 0.2, "filter_tag": "B6"}, {"search_term": "shinearmor car wax", "performance": "Below Average (0.83)", "st_hits": 69, "gmv_oppt": 52.0, "outcome": 7, "express_share": 0.29, "filter_tag": "B7"}, {"search_term": "armorall car wax", "performance": "Below Average (0.79)", "st_hits": 185, "gmv_oppt": 118.0, "outcome": 4, "express_share": 1.0, "filter_tag": "B4"}, {"search_term": "3m car wax", "performance": "Below Average (0.72)", "st_hits": 254, "gmv_oppt": 346.0, "outcome": 1, "express_share": 1.0, "filter_tag": "B1"}, {"search_term": "tcut car wax", "performance": "Average (0.89)", "st_hits": 23, "gmv_oppt": 28.0, "outcome": 3, "express_share": 0.2, "filter_tag": "B3"}, {"search_term": "turtlewax car wax", "performance": "Poor (0.70)", "st_hits": 323, "gmv_oppt": 263.0, "outcome": 2, "express_share": 1.0, "filter_tag": "B2"}, {"search_term": "meguiars car wax", "performance": "Below Average (0.85)", "st_hits": 277, "gmv_oppt": 469.0, "outcome": 5, "express_share": 0.87, "filter_tag": "B5"}];
    const DATA_DETAIL  = [{"search_term": "sonax car wax", "brand_actionable": "SONAX is present on both noon and Amazon with 15 and 15 SKUs respectively, all relevant to automotive wax and related car care subcategory.", "assortment_actionable": "Variant overlap is strong with similar core wax products; Amazon offers a few additional polish and professional-grade items (e.g., Profiline EX) not on noon.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=sonax%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=sonax+car+wax", "outcome": 9, "filter_tag": "B9", "performance_tag": "Below Average", "express_share": 1.0, "st_hits": 139, "gmv_oppt": 136.0}, {"search_term": "simoniz car wax", "brand_actionable": "Simoniz is present on both noon and Amazon with multiple SKUs; noon shows 9 relevant Simoniz wax/shampoo products, Amazon has 7 relevant Simoniz wax/shampoo variants.", "assortment_actionable": "Noon and Amazon offer similar Simoniz car wax/shampoo variants; noon lacks some quick shine/detailer wax types (e.g., SAPP0186A) found on Amazon but overall relevance and variety align well.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=simoniz%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=simoniz+car+wax", "outcome": 8, "filter_tag": "B8", "performance_tag": "Below Average", "express_share": 0.33, "st_hits": 46, "gmv_oppt": 39.0}, {"search_term": "formula1 car wax", "brand_actionable": "Formula 1 is well represented on noon with 12 relevant SKUs matching keyword+category+subcategory, Amazon shows similar Formula 1 presence with slightly fewer SKUs; brand presence is strong and relevant on both.", "assortment_actionable": "Formula 1 variants on noon cover paste, liquid, carnauba, and scratch out waxes, similar to Amazon’s range; noon includes some additional protectants and fragrances, maintaining strong variant diversity.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=formula1%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=formula1+car+wax", "outcome": 10, "filter_tag": "B10", "performance_tag": "Good", "express_share": 0.93, "st_hits": 162, "gmv_oppt": 145.0}, {"search_term": "liquimoly car wax", "brand_actionable": "Liqui Moly is present on both noon (2 SKUs) and Amazon (2 SKUs) with relevant car wax products matching the keyword and category+subcategory.", "assortment_actionable": "Noon shows fewer Liqui Moly car wax variants limited to rust protection and polish & wax, while Amazon offers similar count but with additional friction modifier product.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=liquimoly%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=liquimoly+car+wax", "outcome": 6, "filter_tag": "B6", "performance_tag": "Below Average", "express_share": 0.2, "st_hits": 115, "gmv_oppt": 101.0}, {"search_term": "shinearmor car wax", "brand_actionable": "SHINE ARMOR is present on both noon and Amazon with multiple SKUs strictly relevant to automotive wax category; noon shows more SKUs than Amazon for this brand.", "assortment_actionable": "Noon offers a broader range of SHINE ARMOR wax variants including ceramic coatings and spray waxes, while Amazon shows fewer SKUs and some unrelated products in results.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=shinearmor%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=shinearmor+car+wax", "outcome": 7, "filter_tag": "B7", "performance_tag": "Below Average", "express_share": 0.29, "st_hits": 69, "gmv_oppt": 52.0}, {"search_term": "armorall car wax", "brand_actionable": "Armor All is present on both noon and Amazon with 15 and 14 SKUs respectively, all relevant to automotive wax category and subcategory.", "assortment_actionable": "Variants on noon focus on wash and wax, protectants, and speed wax sprays; Amazon offers additional paste wax and ceramic coating variants, showing slightly broader product types.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=armorall%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=armorall+car+wax", "outcome": 4, "filter_tag": "B4", "performance_tag": "Below Average", "express_share": 1.0, "st_hits": 185, "gmv_oppt": 118.0}, {"search_term": "3m car wax", "brand_actionable": "3M is present on both noon and Amazon with multiple SKUs relevant to automotive wax; noon shows mostly compounds and cleaners, fewer pure wax variants than Amazon.", "assortment_actionable": "Noon’s assortment focuses on compounds and cleaners under 3M, lacking pure wax types like quick wax, liquid wax, and specialty cream wax found on Amazon.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=3m%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=3m+car+wax", "outcome": 1, "filter_tag": "B1", "performance_tag": "Below Average", "express_share": 1.0, "st_hits": 254, "gmv_oppt": 346.0}, {"search_term": "tcut car wax", "brand_actionable": "Brand T-Cut is present on both noon (4 SKUs) and Amazon (8 SKUs) with relevant car wax products matching keyword and subcategory.", "assortment_actionable": "T-Cut variants on noon are fewer (4) than Amazon (8), with Amazon offering kits and applicator sets beyond basic wax polishes.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=tcut%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=tcut+car+wax", "outcome": 3, "filter_tag": "B3", "performance_tag": "Average", "express_share": 0.2, "st_hits": 23, "gmv_oppt": 28.0}, {"search_term": "turtlewax car wax", "brand_actionable": "Turtle wax is present on both noon (2 SKUs) and Amazon (15 SKUs) with relevant car wax and related products; noon shows fewer SKUs but relevant to automotive wax category.", "assortment_actionable": "Noon offers fewer Turtle wax car wax variants and related products compared to Amazon’s broader range including ceramic and hybrid solutions; some noon items are less focused on wax.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=turtlewax%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=turtlewax+car+wax", "outcome": 2, "filter_tag": "B2", "performance_tag": "Poor", "express_share": 1.0, "st_hits": 323, "gmv_oppt": 263.0}, {"search_term": "meguiars car wax", "brand_actionable": "Meguiar's is well represented on both noon and Amazon with 15 and 15 SKUs respectively, all relevant to automotive wax category and subcategory.", "assortment_actionable": "Both platforms show a wide range of Meguiar's wax variants including paste, liquid, spray, and ceramic coatings, with similar depth and strong relevance to car wax.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=meguiars%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=meguiars+car+wax", "outcome": 5, "filter_tag": "B5", "performance_tag": "Below Average", "express_share": 0.87, "st_hits": 277, "gmv_oppt": 469.0}, {"search_term": "car wax", "brand_actionable": "Brands missing on noon: SONAX, Simoniz, 3M, Meguiar's. Common brands: Turtle Wax, Formula 1, ARMOR ALL, Shine Armor.", "assortment_actionable": "Noon shows fewer premium and hybrid wax variants (e.g., Turtle Wax Hybrid Solutions, Meguiar's Ceramic) and includes some off-scope items like scratch repair kits, compared with Amazon’s broader, cleaner assortment.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=car+wax", "outcome": 1, "filter_tag": "G1", "performance_tag": "Below Average", "express_share": 0.93, "st_hits": 693, "gmv_oppt": 620.0}, {"search_term": "liquid car wax", "brand_actionable": "Brands missing on noon: 3M, Meguiar's, SONAX. Common brands: Turtle wax, ARMOR ALL, Formula 1, Herios, Shine Armor.", "assortment_actionable": "Noon shows fewer premium and specialty liquid wax variants (e.g., Meguiar's ceramic, Turtle Wax Hybrid) and some higher-priced options, while Amazon has broader variant depth and cleaner relevance.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=liquid%20car%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=liquid+car+wax", "outcome": 2, "filter_tag": "G2", "performance_tag": "Good", "express_share": 1.0, "st_hits": 139, "gmv_oppt": 133.0}, {"search_term": "premium car wax 500ml", "brand_actionable": "Brands missing on noon: Armor All, Maddox Detail. Common brands: HERIOS, SONAX, Turtle Wax, LIQUI MOLY.", "assortment_actionable": "Noon includes premium and spray wax variants but shows fewer Armor All and Maddox Detail options; some off-scope items like interior cleaner appear versus Amazon’s tighter focus.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=premium%20car%20wax%20500ml&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=premium+car+wax+500ml", "outcome": 4, "filter_tag": "G4", "performance_tag": "Good", "express_share": 0.43, "st_hits": 46, "gmv_oppt": 38.0}, {"search_term": "carnauba wax", "brand_actionable": "Brands missing on noon: Meguiar's, Great Bay Ingredients, Car Gods, Wavex, HAWAII. Common brands: Formula 1, Simoniz, Turtle Wax, Getsun, Herios.", "assortment_actionable": "Noon shows fewer premium and bulk carnauba wax variants (e.g., Meguiar's paste/liquid, bulk flakes) and some off-scope items like wash shampoos, while Amazon offers broader variant types and purer wax forms.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=carnauba%20wax&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=carnauba+wax", "outcome": 3, "filter_tag": "G3", "performance_tag": "Excellent", "express_share": 0.93, "st_hits": 92, "gmv_oppt": 95.0}, {"search_term": "car wax for scratches", "brand_actionable": "Brands missing on noon: Meguiar's, Shine Armor, PINKE, NALACAL, Sonax, Fitto, T-Cut, Waxpol. Common brands: Turtle Wax, Formula 1.", "assortment_actionable": "Noon shows more generic and Turtle Wax SKUs but fewer premium brands and fewer variant types like compounds and ceramic coatings seen on Amazon; some overlap in product types but Amazon has broader brand variety.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=car%20wax%20for%20scratches&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=car+wax+for+scratches", "outcome": 5, "filter_tag": "G5", "performance_tag": "Average", "express_share": 1.0, "st_hits": 231, "gmv_oppt": 161.0}];

    const clean_text = (text) => text.replace(/ /g, '_')

    const linkToDetail = (term) => `<a class="kw-link" href=#${term.replace(/ /g, '_')}>${term}</a>`;

    const toNumber = (v) => {
      if (v === null || v === undefined) return NaN;
      if (typeof v === 'number') return v;
      if (typeof v === 'string') {
        const s = v.replace(/,/g, '').trim();
        return s === '' ? NaN : Number(s);
      }
      return NaN;
    };
    const fmtInt = (v) => Number.isFinite(toNumber(v)) ? toNumber(v).toLocaleString() : "—";
    const fmtNum = (v) =>
      Number.isFinite(toNumber(v))
        ? toNumber(v).toLocaleString(undefined, { minimumFractionDigits:0, maximumFractionDigits:2 })
        : "—";

    const toLink = (url, label) => {
      if (!url || typeof url !== 'string') return '';
      const safe = url.startsWith('http') ? url : null;
      return safe ? `<a href="${safe}" target="_blank" rel="noopener">${label || 'Open'}</a>` : '';
    };
    const escapeHTML = (s) =>
      String(s ?? '').replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);

    // Build single "Actionables" cell (no Show more / no clamping)
    const makeActionablesCell = (row) => {
      const items = [];
      if (row.assortment_actionable) items.push(`<div class="act"><div class="tag">Assortment</div><div class="txt wrap-text">${escapeHTML(row.assortment_actionable)}</div></div>`);
      if (row.brand_actionable) items.push(`<div class="act"><div class="tag">Brand</div><div class="txt wrap-text">${escapeHTML(row.brand_actionable)}</div></div>`);
      const content = items.join('');
      return `<div class="cell-stack"><div class="wrap-text">${content}</div></div>`;
    };

    // Helper: pick GMV opportunity from available keys (gmv_oppt preferred)
    const pickGmvOppt = (row) => {
      const v = row.gmv_oppt ?? row.gmv_loss ?? row.gmv_opportunity ?? null;
      return v;
    };

    // Helper: get keyword type from outcome/priority
    function getKeywordType(outcome) {
      if (typeof outcome !== "string") return "";
      if (/^B\d+$/i.test(outcome.trim())) return "B";
      if (/^G\d+$/i.test(outcome.trim())) return "G";
      return "";
    }

    // Custom natural sort for filter_tag (e.g., G1, G2, ..., G10, B1, B2, ...)
    function filterTagNaturalSort(a, b) {
      // a and b are the cell values (e.g., "G1", "G10", "B2", etc.)
      // Handle null/undefined/empty
      a = (a || '').toUpperCase();
      b = (b || '').toUpperCase();
      // Extract letter prefix and number
      const re = /^([A-Z]+)(\d+)$/i;
      const ma = a.match(re);
      const mb = b.match(re);
      if (ma && mb) {
        // Compare prefix first
        if (ma[1] < mb[1]) return -1;
        if (ma[1] > mb[1]) return 1;
        // Compare number as integer
        const na = parseInt(ma[2], 10);
        const nb = parseInt(mb[2], 10);
        return na - nb;
      }
      // If only one matches, put matching one first
      if (ma) return -1;
      if (mb) return 1;
      // Fallback to string compare
      return a.localeCompare(b);
    }

    // Register the custom sort with DataTables
    if (window.jQuery && $.fn.dataTable) {
      // Ascending
      $.fn.dataTable.ext.type.order['filter-tag-nat-asc'] = function(a, b) {
        return filterTagNaturalSort(a, b);
      };
      // Descending
      $.fn.dataTable.ext.type.order['filter-tag-nat-desc'] = function(a, b) {
        return filterTagNaturalSort(b, a);
      };
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('pill-score').textContent = fmtInt(EXEC_SUMMARY.overall_score ?? 0);
      document.getElementById('pill-hits').textContent  = fmtInt(EXEC_SUMMARY.overall_st_hits);
      document.getElementById('pill-gmv').textContent   = fmtNum(EXEC_SUMMARY.overall_gmv_oppt);

      // Generic table (center columns)
      $('#tbl-generic').DataTable({
        data: DATA_GENERIC,
        columns: [
          { title:'Search Term',     data:'search_term', className:'text-center align-middle', render:(d)=>linkToDetail(d)},
          { 
            title:'Priority',        
            data:'filter_tag',       
            className:'text-center align-middle', 
            render:(d)=>escapeHTML(d ?? '—'),
            type: 'filter-tag-nat' // Use our custom natural sort
          },
          { title:'Est. Hits',     data:'st_hits',     className:'text-center align-middle', render:(d)=>fmtInt(d) },
          { title:'Est. GMV Potential', data:'gmv_oppt',      className:'text-center align-middle', render:(d)=>fmtNum(d) },
          { title:'Express share', data:'express_share', className:'text-center align-middle', render:(d)=>
            Number.isFinite(toNumber(d))
              ? (toNumber(d)*100).toLocaleString(undefined, undefined) + '%'
              : "—"
          }
        ],
        order: [[1,'asc']], responsive: true, fixedHeader: false, deferRender: true, autoWidth: false,
        pageLength: 10, lengthMenu: [10,25,50,100], dom:'Bfrtip', buttons:['pageLength','copy','csv']
      });

      // Branded table (center columns)
      $('#tbl-branded').DataTable({
        data: DATA_BRANDED,
        columns: [
          { title:'Search Term',     data:'search_term', className:'text-center align-middle', render:(d)=>linkToDetail(d) },
          { 
            title:'Priority',        
            data:'filter_tag',       
            className:'text-center align-middle', 
            render:(d)=>escapeHTML(d ?? '—'),
            type: 'filter-tag-nat' // Use our custom natural sort
          },
          { title:'Est. Hits',     data:'st_hits',     className:'text-center align-middle', render:(d)=>fmtInt(d) },
          { title:'Est. GMV Potential', data:'gmv_oppt',      className:'text-center align-middle', render:(d)=>fmtNum(d) },
          { title:'Express share', data:'express_share', className:'text-center align-middle', render:(d)=>
            Number.isFinite(toNumber(d))
              ? (toNumber(d)*100).toLocaleString(undefined, undefined) + '%'
              : "—"
          }
        ],
        order: [[1,'asc']], responsive: true, fixedHeader: false, deferRender: true, autoWidth: false,
        pageLength: 10, lengthMenu: [10,25,50,100], dom:'Bfrtip', buttons:['pageLength','copy','csv']
      });

      // Detailed Analysis (center everything except Actionables)
      const dtDetail = $('#tbl-detail').DataTable({
        data: DATA_DETAIL,
        columns: [
          { title:'Search Term',     data:'search_term',   width:'10%', className:'text-center align-middle' },
          { 
            title:'Priority',        
            data:'filter_tag',       
            width:'8%', 
            className:'text-center align-middle', 
            render:(d)=>escapeHTML(d ?? '—'),
            type: 'filter-tag-nat' // Use our custom natural sort
          },
          { title:'Insights',        data:null,            width:'44%', className:'col-actionables', render:(d,t,row)=>makeActionablesCell(row) },
          { title:'Est. Hits',       data:'st_hits',       width:'8%', className:'text-center align-middle', render:(d)=>fmtInt(d) },
          { title:'Est. GMV Potential', data:null,          width:'10%', className:'text-center align-middle', render:(d,t,row)=>fmtNum(pickGmvOppt(row)) },
          { title:'Express share',   data:'express_share', className:'text-center align-middle', render:(d)=>
            Number.isFinite(toNumber(d))
              ? (toNumber(d)*100).toLocaleString(undefined, undefined) + '%'
              : "—"
          },
          { title:'PLP',             data:null,            width:'10%', className:'text-center align-middle',
          render:(d,t,row)=>{const parts = [];
            if (row.noon_plp_link)   parts.push(toLink(row.noon_plp_link,   'noon search results'));
            if (row.amazon_plp_link) parts.push(toLink(row.amazon_plp_link, 'Amazon search results'));
            return parts.length ? '<div class="plp-links">' + parts.join('') + '</div>' : '—';
          }
          }
        ],
        order: [[1,'asc']], responsive: false, fixedHeader: false, deferRender: true, autoWidth: false,
        pageLength: 15, lengthMenu: [15,25,50,100], dom:'Bfrtip', buttons:['pageLength','copy','csv'],
        rowId: (d) => d.search_term.replace(/ /g, '_')
      });
    });
  </script>
</body>
</html>
