<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Search Assortment — automotive / dash_camera</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Fonts: Proxima Nova if installed, else Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- DataTables + Buttons -->
  <link rel="stylesheet" href="https://cdn.datatables.net/v/bs5/dt-2.0.3/b-3.0.1/fh-4.0.1/r-3.0.1/datatables.min.css"/>

  <style>
    :root {
      --bg: #0f1220;
      --card: #141a2a;
      --card-2: #181e31;
      --text: #f3f6ff;
      --text-dim: #b8c1d9;
      --border: #252c42;
      --brand: #7aa2ff;
      --brand-soft: #1a2340;
      --card-radius: 14px;
    }
    * { font-family: "Proxima Nova", Inter, "Segoe UI", Roboto, system-ui, -apple-system, Arial, sans-serif; }
    html, body { background: var(--bg); color: var(--text); }

    .page-header {
      background: radial-gradient(1200px 400px at 10% -10%, rgba(122,162,255,.25), transparent),
                  linear-gradient(90deg, var(--brand-soft), rgba(10,14,25,0.6));
      border-bottom: 1px solid var(--border);
    }
    .page-header h2 { font-weight: 700; letter-spacing:.2px; color: var(--text); }
    .muted { color: var(--text-dim); }

    .btn, .btn:focus, .btn:active { box-shadow:none; }
    .btn-outline-secondary { color: var(--text); border-color: var(--border); }
    .btn-outline-secondary:hover { background: var(--card-2); border-color: var(--border); }
    .btn-outline-primary { color: var(--text); border-color: var(--brand); }
    .btn-outline-primary:hover { background: rgba(122,162,255,.12); }

    .section-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--card-radius);
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      padding: 1rem 1.1rem 1.25rem 1.1rem;
      height: 100%;
      contain: content;
      color: var(--text);
    }
    .section-title { font-weight: 700; font-size: 1.05rem; margin-bottom:.6rem; color: var(--text); }

    /* Executive summary pills */
    .summary-pill {
      border-radius: 999px;
      padding:.7rem 1.1rem;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border);
      display:inline-flex; gap:.6rem; align-items:center;
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
      margin:.3rem .6rem .3rem 0;
    }
    .summary-pill .label { color: var(--text-dim); font-size:.9rem; }
    .summary-pill .value { font-weight:700; color: var(--text); font-size:1.05rem; }

    /* DataTables dark theme */
    table.dataTable { table-layout: fixed; color: var(--text); }
    table.table {
      --bs-table-color: var(--text);
      --bs-table-bg: transparent;
      --bs-table-striped-color: var(--text);
      --bs-table-hover-color: var(--text);
      --bs-table-border-color: var(--border);
      --bs-table-striped-bg: rgba(255,255,255,0.06);
      --bs-table-hover-bg: rgba(255,255,255,0.08);
    }
    /* Center headers horizontally + vertically */
    table.dataTable thead th {
      background: var(--card-2) !important;
      border-bottom: 1px solid var(--border) !important;
      color: var(--text) !important;
      text-align: center !important;
      vertical-align: middle !important;
    }
    /* Center body cells horizontally + vertically by default */
    table.dataTable tbody td {
      border-color: var(--border);
      color: var(--text);
      text-align: center;
      vertical-align: middle;
    }
    /* Override DataTables' numeric right-align helpers */
    table.dataTable td.dt-type-numeric,
    table.dataTable th.dt-type-numeric,
    table.dataTable td.dt-right,
    table.dataTable th.dt-right,
    table.dataTable td.dt-body-right,
    table.dataTable th.dt-head-right {
      text-align: center !important;
    }

    /* Inputs */
    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_length label,
    .dataTables_wrapper .dataTables_filter label { color: var(--text-dim); }
    .dataTables_wrapper .dataTables_filter input,
    .dataTables_wrapper .dataTables_length select {
      background: var(--card-2);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .dataTables_wrapper .dataTables_filter input::placeholder { color: var(--text-dim); }

    /* Pagination */
    .dataTables_wrapper .dataTables_paginate .paginate_button {
      color: var(--text) !important; border-color: var(--border) !important;
      background: transparent !important;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      background: var(--brand-soft) !important; border-color: var(--border) !important; color: var(--text) !important;
    }

    a, a:visited { color: var(--brand); }
    a:hover { color: #aecdff; }

    /* Long text handling */
    .wrap-text { white-space: pre-wrap; line-height:1.35rem; color: var(--text); }

    /* Actionables block */
    .act {
      display: grid;
      grid-template-columns: 130px 1fr;
      align-items: center;
      column-gap: .8rem;
      background: var(--card-2); border: 1px solid var(--border);
      border-radius: 12px; padding:.65rem .8rem; color: var(--text);
      text-align: left;
    }
    .act .tag {
      justify-self: center;
      font-size:.72rem; font-weight:700; text-transform:uppercase;
      letter-spacing:.04em; color: var(--brand);
      padding:.22rem .55rem; border:1px solid var(--brand); border-radius:999px;
      background: rgba(122,162,255,.08);
    }
    .act .txt { color: var(--text); }

    /* Left-align ONLY the Actionables column */
    td.col-actionables, th.col-actionables {
      text-align: left !important;
      vertical-align: top !important;
    }

    /* PLP combined cell: stack links vertically */
    .plp-links a { display:block; line-height:1.2; margin-bottom:.25rem; }

    .footer-note { color: var(--text-dim); font-size:.85rem; }

    /* Filter dropdown styling */
    .filter-bar {
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      align-items: center;
    }
  </style>
</head>

<body>
  <header class="page-header py-3">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-between">
        <div>
          <h2 class="mb-0">Search Assortment — automotive / dash_camera</h2>
          <div class="muted">Category: <strong>automotive</strong> &nbsp;|&nbsp; Subtype: <strong>dash_camera</strong></div>
        </div>
        <div class="text-end">
          <a class="btn btn-outline-secondary btn-sm" href="#" onclick="window.print()">Print</a>
        </div>
      </div>
    </div>
  </header>

  <main class="container my-4">

    <!-- Executive Summary -->
    <div class="section-card mb-4">
      <div class="d-flex align-items-center flex-wrap">
        <div class="summary-pill"><span class="label">Category GMV (AED, L30D)</span><span class="value" id="pill-score">—</span></div>
        <div class="summary-pill"><span class="label">Overall Est. Search Hits (L30D)</span><span class="value" id="pill-hits">—</span></div>
        <div class="summary-pill"><span class="label">Overall Est. GMV Opportunity (AED, L30D) </span><span class="value" id="pill-gmv">—</span></div>
        <div class="muted text-start" style="font-size:0.72em;">Results compare the top 15 products from noon and Amazon. Some brands marked as missing may appear lower 
        on noon but are present in Amazon's top 15. Est. potential GMV is estimated based on ideal search hits share on the keywords (given an ideal assortment), 
        category average conversion and Amazon's average offer price</div>
      </div>
    </div>

    <!-- Keyword level insights -->
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="section-card">
          <div class="section-title">Keyword Insights — Generic</div>
          <table id="tbl-generic" class="table table-striped table-hover w-100"></table>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="section-card">
          <div class="section-title">Keyword Insights — Branded</div>
          <table id="tbl-branded" class="table table-striped table-hover w-100"></table>
        </div>
      </div>
    </div>

    <!-- Detailed analysis -->
    <div class="section-card mt-4">
      <div class="d-flex justify-content-between align-items-center">
        <div class="section-title mb-0">Detailed Analysis</div>
      </div>
      <p class="muted mb-2">Actionables per search term. B1 refers to priority for branded keywords, and G1 for generic</p>
      <table id="tbl-detail" class="table table-striped table-hover w-100"></table>
    </div>

    <div class="my-4 footer-note">
      Data source: <code>noonbigmerchsandbox.satyam.search_assortment_eval_final_draft3</code>. Report for <strong>automotive × dash_camera</strong>. Generated on : <strong>23 Sep 2025, 07:24 PM</strong>
    </div>
  </main>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/v/bs5/dt-2.0.3/b-3.0.1/fh-4.0.1/r-3.0.1/datatables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <script>
    const EXEC_SUMMARY = {"overall_score": 72968.0, "overall_st_hits": 5119, "overall_gmv_oppt": 41625.0};
    const DATA_GENERIC = [{"search_term": "dash camera for car 4k", "performance": "Excellent (0.95)", "st_hits": 988, "gmv_oppt": 6940.0, "outcome": 3, "express_share": 1.0, "filter_tag": "G3"}, {"search_term": "compact dash camera", "performance": "Good (0.91)", "st_hits": 198, "gmv_oppt": 1052.0, "outcome": 1, "express_share": 0.93, "filter_tag": "G1"}, {"search_term": "dual channel dash camera", "performance": "Good (0.94)", "st_hits": 296, "gmv_oppt": 1545.0, "outcome": 5, "express_share": 1.0, "filter_tag": "G5"}, {"search_term": "full hd dash camera", "performance": "Excellent (0.96)", "st_hits": 494, "gmv_oppt": 1710.0, "outcome": 2, "express_share": 1.0, "filter_tag": "G2"}, {"search_term": "4k dash camera", "performance": "Excellent (0.95)", "st_hits": 791, "gmv_oppt": 4867.0, "outcome": 4, "express_share": 1.0, "filter_tag": "G4"}];
    const DATA_BRANDED = [{"search_term": "rove dash camera", "performance": "Good (0.93)", "st_hits": 247, "gmv_oppt": 1660.0, "outcome": 3, "express_share": 0.0, "filter_tag": "B3"}, {"search_term": "wolfbox dash camera", "performance": "Good (0.91)", "st_hits": 30, "gmv_oppt": 480.0, "outcome": 4, "express_share": 0.5, "filter_tag": "B4"}, {"search_term": "ddpai dash camera", "performance": "Average (0.86)", "st_hits": 346, "gmv_oppt": 3123.0, "outcome": 2, "express_share": 0.3, "filter_tag": "B2"}, {"search_term": "70mai dash camera", "performance": "Excellent (0.95)", "st_hits": 642, "gmv_oppt": 4414.0, "outcome": 7, "express_share": 1.0, "filter_tag": "B7"}, {"search_term": "pioneer dash camera", "performance": "Good (0.93)", "st_hits": 148, "gmv_oppt": 1284.0, "outcome": 10, "express_share": 0.73, "filter_tag": "B10"}, {"search_term": "garmin dash camera", "performance": "Average (0.85)", "st_hits": 395, "gmv_oppt": 6854.0, "outcome": 5, "express_share": 0.07, "filter_tag": "B5"}, {"search_term": "vantrue dash camera", "performance": "Below Average (0.71)", "st_hits": 296, "gmv_oppt": 5874.0, "outcome": 1, "express_share": 0.0, "filter_tag": "B1"}, {"search_term": "powerology dash camera", "performance": "Below Average (0.72)", "st_hits": 20, "gmv_oppt": 106.0, "outcome": 6, "express_share": 0.67, "filter_tag": "B6"}, {"search_term": "azdome dash camera", "performance": "Excellent (0.96)", "st_hits": 198, "gmv_oppt": 1483.0, "outcome": 8, "express_share": 0.53, "filter_tag": "B8"}, {"search_term": "botslab dash camera", "performance": "Below Average (0.84)", "st_hits": 30, "gmv_oppt": 234.0, "outcome": 9, "express_share": 0.79, "filter_tag": "B9"}];
    const DATA_DETAIL  = [{"search_term": "rove dash camera", "brand_actionable": "ROVE brand is well represented on noon with multiple relevant dash cam SKUs matching category and subcategory; Amazon shows slightly more variants including R3 model.", "assortment_actionable": "ROVE dash cams on noon cover key models like R2-4K, R2-4K PRO, and DUAL but lack newer R3 variants seen on Amazon; accessories and mounts are also present on noon.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=rove%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=rove+dash+camera", "outcome": 3, "filter_tag": "B3", "performance_tag": "Good", "express_share": 0.0, "st_hits": 247, "gmv_oppt": 1660.0}, {"search_term": "wolfbox dash camera", "brand_actionable": "WOLFBOX is present on both noon and Amazon with 8 and 15 SKUs respectively; all products are relevant dash cameras matching the keyword and subcategory.", "assortment_actionable": "Variants on noon cover key models like G900, G930, G840S but fewer than Amazon, which offers broader options including G850, i07, i17, X5 and more storage card inclusions.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=wolfbox%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=wolfbox+dash+camera", "outcome": 4, "filter_tag": "B4", "performance_tag": "Good", "express_share": 0.5, "st_hits": 30, "gmv_oppt": 480.0}, {"search_term": "ddpai dash camera", "brand_actionable": "Brand ddpai is well represented on both noon and Amazon with 10 and 15 SKUs respectively, all relevant to dash cameras in automotive category.", "assortment_actionable": "Noon shows slightly fewer ddpai dash camera variants, lacking some 3-channel and 4G LTE models available on Amazon, but coverage remains focused and relevant.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=ddpai%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=ddpai+dash+camera", "outcome": 2, "filter_tag": "B2", "performance_tag": "Average", "express_share": 0.3, "st_hits": 346, "gmv_oppt": 3123.0}, {"search_term": "70mai dash camera", "brand_actionable": "Brand 70mai is present on both noon and Amazon with strong SKU presence and relevant dash camera products matching keyword, category, and subcategory.", "assortment_actionable": "Variants cover front, rear, dual-channel, 4K, HDR, GPS, and parking modes on both; noon shows slightly fewer premium 4G LTE and rear camera SKUs than Amazon.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=70mai%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=70mai+dash+camera", "outcome": 7, "filter_tag": "B7", "performance_tag": "Excellent", "express_share": 1.0, "st_hits": 642, "gmv_oppt": 4414.0}, {"search_term": "pioneer dash camera", "brand_actionable": "Pioneer is present on both noon (15 SKUs) and Amazon (8 SKUs) with relevant dash camera products matching keyword+category+subcategory.", "assortment_actionable": "Noon offers a broader range of Pioneer dash camera variants with multiple models and resolutions, while Amazon includes fewer Pioneer SKUs but more other brand dash cams.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=pioneer%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=pioneer+dash+camera", "outcome": 10, "filter_tag": "B10", "performance_tag": "Good", "express_share": 0.73, "st_hits": 148, "gmv_oppt": 1284.0}, {"search_term": "garmin dash camera", "brand_actionable": "Garmin is well represented on noon with 9 relevant dash camera SKUs matching keyword+category+subcategory, comparable to Amazon’s 6 Garmin dash cams plus 1 accessory.", "assortment_actionable": "Noon shows a strong range of Garmin dash cam models (Mini 3, X110, X210, Compact 56, DriveCam 76) similar to Amazon, with fewer 4K and dual-lens variants.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=garmin%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=garmin+dash+camera", "outcome": 5, "filter_tag": "B5", "performance_tag": "Average", "express_share": 0.07, "st_hits": 395, "gmv_oppt": 6854.0}, {"search_term": "vantrue dash camera", "brand_actionable": "Vantrue is present on noon with 2 relevant SKUs; Amazon offers a broader Vantrue range with 15 SKUs, all strictly relevant to dash camera category.", "assortment_actionable": "Noon shows fewer Vantrue dash camera variants (2 vs. 15 on Amazon), with limited model diversity; accessories appear but do not compensate for core dash cam assortment gap.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=vantrue%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=vantrue+dash+camera", "outcome": 1, "filter_tag": "B1", "performance_tag": "Below Average", "express_share": 0.0, "st_hits": 296, "gmv_oppt": 5874.0}, {"search_term": "powerology dash camera", "brand_actionable": "Powerology is present on both noon (6 SKUs) and Amazon (1 SKU), with all products relevant to dash cameras on both platforms.", "assortment_actionable": "Noon shows more Powerology dash camera variants (4K, dual lens, parking monitor) than Amazon, with no notable gaps in relevant dash camera SKUs.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=powerology%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=powerology+dash+camera", "outcome": 6, "filter_tag": "B6", "performance_tag": "Below Average", "express_share": 0.67, "st_hits": 20, "gmv_oppt": 106.0}, {"search_term": "azdome dash camera", "brand_actionable": "AZDOME is well represented on both noon and Amazon with 15 and 10 relevant dash camera SKUs respectively, all matching the keyword, category, and subcategory.", "assortment_actionable": "Variants cover multi-channel, 4K, GPS, WiFi, night vision, and parking modes on both platforms with similar depth; noon includes some accessories but focus remains on dash cams.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=azdome%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=azdome+dash+camera", "outcome": 8, "filter_tag": "B8", "performance_tag": "Excellent", "express_share": 0.53, "st_hits": 198, "gmv_oppt": 1483.0}, {"search_term": "botslab dash camera", "brand_actionable": "Botslab is well represented on both noon and Amazon with 15 and 8 relevant dash camera SKUs respectively, all matching the keyword and category+subcategory.", "assortment_actionable": "Botslab dash cams on noon show a wide range of models including 4K, 3K, 2.5K, front/rear, and smart features, comparable to Amazon’s variety and variant depth.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=botslab%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=botslab+dash+camera", "outcome": 9, "filter_tag": "B9", "performance_tag": "Below Average", "express_share": 0.79, "st_hits": 30, "gmv_oppt": 234.0}, {"search_term": "dash camera for car 4k", "brand_actionable": "Brands missing on noon: ROVE, REDTIGER, WOLFBOX, Azacvb, Luocute. Common brands: 70mai.", "assortment_actionable": "4K dash cam variants on noon include multiple 70mai models and others with advanced features; Amazon shows broader brand variety and some lower-priced options, with no irrelevant items.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=dash%20camera%20for%20car%204k&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=dash+camera+for+car+4k", "outcome": 3, "filter_tag": "G3", "performance_tag": "Excellent", "express_share": 1.0, "st_hits": 988, "gmv_oppt": 6940.0}, {"search_term": "compact dash camera", "brand_actionable": "Brands missing on noon: ROVE, DDPAI, Botslab, Exrp, Byson, REDTIGER, Vantrue. Common brands: Pioneer, Garmin, 70mai.", "assortment_actionable": "Compact/travel dash cams are fewer and generics dominate noon results, with some irrelevant items like DVR mirrors; Amazon shows stronger branded range and more consistent in-scope models.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=compact%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=compact+dash+camera", "outcome": 1, "filter_tag": "G1", "performance_tag": "Good", "express_share": 0.93, "st_hits": 198, "gmv_oppt": 1052.0}, {"search_term": "dual channel dash camera", "brand_actionable": "Brands missing on noon: ROVE, CRONY, Luocute, REDTIGER, Powerology, Hirige. Common brands: 70mai, AZDOME.", "assortment_actionable": "Variants with 4K, GPS, and parking modes appear on both; noon has fewer non-70mai brands and some generics, while Amazon shows more brand diversity and multi-channel options.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=dual%20channel%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=dual+channel+dash+camera", "outcome": 5, "filter_tag": "G5", "performance_tag": "Good", "express_share": 1.0, "st_hits": 296, "gmv_oppt": 1545.0}, {"search_term": "full hd dash camera", "brand_actionable": "Brands missing on noon: STAYOUNG, REDTIGER, YOUWE7, Sulfar, ROVE, Hirige, KAWA, Esenlong, Cryfokt, STS®, DDPAI. Common brands: None.", "assortment_actionable": "Full HD and 4K dash cams dominate both; noon shows fewer premium 4K and GPS-enabled models (e.g., REDTIGER, ROVE) and more generic/unbranded items than Amazon.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=full%20hd%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=full+hd+dash+camera", "outcome": 2, "filter_tag": "G2", "performance_tag": "Excellent", "express_share": 1.0, "st_hits": 494, "gmv_oppt": 1710.0}, {"search_term": "4k dash camera", "brand_actionable": "Brands missing on noon: ROVE, REDTIGER, WOLFBOX, WOLFANG, Luocute, Azacvb, Luocute, Azacvb. Common brands: 70mai, AZDOME, XiuWoo.", "assortment_actionable": "4K dash cam variants on noon include multi-channel, GPS, WiFi, and parking modes but lack some Amazon brands and lower-priced compact models; some non-dash cam items appear on noon.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=4k%20dash%20camera&av=0&e[search-ae]=google", "amazon_plp_link": "https://www.amazon.ae/s?k=4k+dash+camera", "outcome": 4, "filter_tag": "G4", "performance_tag": "Excellent", "express_share": 1.0, "st_hits": 791, "gmv_oppt": 4867.0}];

    const clean_text = (text) => text.replace(/ /g, '_')

    const linkToDetail = (term) => `<a class="kw-link" href=#${term.replace(/ /g, '_')}>${term}</a>`;

    const toNumber = (v) => {
      if (v === null || v === undefined) return NaN;
      if (typeof v === 'number') return v;
      if (typeof v === 'string') {
        const s = v.replace(/,/g, '').trim();
        return s === '' ? NaN : Number(s);
      }
      return NaN;
    };
    const fmtInt = (v) => Number.isFinite(toNumber(v)) ? toNumber(v).toLocaleString() : "—";
    const fmtNum = (v) =>
      Number.isFinite(toNumber(v))
        ? toNumber(v).toLocaleString(undefined, { minimumFractionDigits:0, maximumFractionDigits:2 })
        : "—";

    const toLink = (url, label) => {
      if (!url || typeof url !== 'string') return '';
      const safe = url.startsWith('http') ? url : null;
      return safe ? `<a href="${safe}" target="_blank" rel="noopener">${label || 'Open'}</a>` : '';
    };
    const escapeHTML = (s) =>
      String(s ?? '').replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);

    // Build single "Actionables" cell (no Show more / no clamping)
    const makeActionablesCell = (row) => {
      const items = [];
      if (row.assortment_actionable) items.push(`<div class="act"><div class="tag">Assortment</div><div class="txt wrap-text">${escapeHTML(row.assortment_actionable)}</div></div>`);
      if (row.brand_actionable) items.push(`<div class="act"><div class="tag">Brand</div><div class="txt wrap-text">${escapeHTML(row.brand_actionable)}</div></div>`);
      const content = items.join('');
      return `<div class="cell-stack"><div class="wrap-text">${content}</div></div>`;
    };

    // Helper: pick GMV opportunity from available keys (gmv_oppt preferred)
    const pickGmvOppt = (row) => {
      const v = row.gmv_oppt ?? row.gmv_loss ?? row.gmv_opportunity ?? null;
      return v;
    };

    // Helper: get keyword type from outcome/priority
    function getKeywordType(outcome) {
      if (typeof outcome !== "string") return "";
      if (/^B\d+$/i.test(outcome.trim())) return "B";
      if (/^G\d+$/i.test(outcome.trim())) return "G";
      return "";
    }

    // Custom natural sort for filter_tag (e.g., G1, G2, ..., G10, B1, B2, ...)
    function filterTagNaturalSort(a, b) {
      // a and b are the cell values (e.g., "G1", "G10", "B2", etc.)
      // Handle null/undefined/empty
      a = (a || '').toUpperCase();
      b = (b || '').toUpperCase();
      // Extract letter prefix and number
      const re = /^([A-Z]+)(\d+)$/i;
      const ma = a.match(re);
      const mb = b.match(re);
      if (ma && mb) {
        // Compare prefix first
        if (ma[1] < mb[1]) return -1;
        if (ma[1] > mb[1]) return 1;
        // Compare number as integer
        const na = parseInt(ma[2], 10);
        const nb = parseInt(mb[2], 10);
        return na - nb;
      }
      // If only one matches, put matching one first
      if (ma) return -1;
      if (mb) return 1;
      // Fallback to string compare
      return a.localeCompare(b);
    }

    // Register the custom sort with DataTables
    if (window.jQuery && $.fn.dataTable) {
      // Ascending
      $.fn.dataTable.ext.type.order['filter-tag-nat-asc'] = function(a, b) {
        return filterTagNaturalSort(a, b);
      };
      // Descending
      $.fn.dataTable.ext.type.order['filter-tag-nat-desc'] = function(a, b) {
        return filterTagNaturalSort(b, a);
      };
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('pill-score').textContent = fmtInt(EXEC_SUMMARY.overall_score ?? 0);
      document.getElementById('pill-hits').textContent  = fmtInt(EXEC_SUMMARY.overall_st_hits);
      document.getElementById('pill-gmv').textContent   = fmtNum(EXEC_SUMMARY.overall_gmv_oppt);

      // Generic table (center columns)
      $('#tbl-generic').DataTable({
        data: DATA_GENERIC,
        columns: [
          { title:'Search Term',     data:'search_term', className:'text-center align-middle', render:(d)=>linkToDetail(d)},
          { 
            title:'Priority',        
            data:'filter_tag',       
            className:'text-center align-middle', 
            render:(d)=>escapeHTML(d ?? '—'),
            type: 'filter-tag-nat' // Use our custom natural sort
          },
          { title:'Est. Hits',     data:'st_hits',     className:'text-center align-middle', render:(d)=>fmtInt(d) },
          { title:'Est. GMV Potential', data:'gmv_oppt',      className:'text-center align-middle', render:(d)=>fmtNum(d) },
          { title:'Express share', data:'express_share', className:'text-center align-middle', render:(d)=>
            Number.isFinite(toNumber(d))
              ? (toNumber(d)*100).toLocaleString(undefined, undefined) + '%'
              : "—"
          }
        ],
        order: [[1,'asc']], responsive: true, fixedHeader: false, deferRender: true, autoWidth: false,
        pageLength: 10, lengthMenu: [10,25,50,100], dom:'Bfrtip', buttons:['pageLength','copy','csv']
      });

      // Branded table (center columns)
      $('#tbl-branded').DataTable({
        data: DATA_BRANDED,
        columns: [
          { title:'Search Term',     data:'search_term', className:'text-center align-middle', render:(d)=>linkToDetail(d) },
          { 
            title:'Priority',        
            data:'filter_tag',       
            className:'text-center align-middle', 
            render:(d)=>escapeHTML(d ?? '—'),
            type: 'filter-tag-nat' // Use our custom natural sort
          },
          { title:'Est. Hits',     data:'st_hits',     className:'text-center align-middle', render:(d)=>fmtInt(d) },
          { title:'Est. GMV Potential', data:'gmv_oppt',      className:'text-center align-middle', render:(d)=>fmtNum(d) },
          { title:'Express share', data:'express_share', className:'text-center align-middle', render:(d)=>
            Number.isFinite(toNumber(d))
              ? (toNumber(d)*100).toLocaleString(undefined, undefined) + '%'
              : "—"
          }
        ],
        order: [[1,'asc']], responsive: true, fixedHeader: false, deferRender: true, autoWidth: false,
        pageLength: 10, lengthMenu: [10,25,50,100], dom:'Bfrtip', buttons:['pageLength','copy','csv']
      });

      // Detailed Analysis (center everything except Actionables)
      const dtDetail = $('#tbl-detail').DataTable({
        data: DATA_DETAIL,
        columns: [
          { title:'Search Term',     data:'search_term',   width:'10%', className:'text-center align-middle' },
          { 
            title:'Priority',        
            data:'filter_tag',       
            width:'8%', 
            className:'text-center align-middle', 
            render:(d)=>escapeHTML(d ?? '—'),
            type: 'filter-tag-nat' // Use our custom natural sort
          },
          { title:'Insights',        data:null,            width:'44%', className:'col-actionables', render:(d,t,row)=>makeActionablesCell(row) },
          { title:'Est. Hits',       data:'st_hits',       width:'8%', className:'text-center align-middle', render:(d)=>fmtInt(d) },
          { title:'Est. GMV Potential', data:null,          width:'10%', className:'text-center align-middle', render:(d,t,row)=>fmtNum(pickGmvOppt(row)) },
          { title:'Express share',   data:'express_share', className:'text-center align-middle', render:(d)=>
            Number.isFinite(toNumber(d))
              ? (toNumber(d)*100).toLocaleString(undefined, undefined) + '%'
              : "—"
          },
          { title:'PLP',             data:null,            width:'10%', className:'text-center align-middle',
          render:(d,t,row)=>{const parts = [];
            if (row.noon_plp_link)   parts.push(toLink(row.noon_plp_link,   'noon search results'));
            if (row.amazon_plp_link) parts.push(toLink(row.amazon_plp_link, 'Amazon search results'));
            return parts.length ? '<div class="plp-links">' + parts.join('') + '</div>' : '—';
          }
          }
        ],
        order: [[1,'asc']], responsive: false, fixedHeader: false, deferRender: true, autoWidth: false,
        pageLength: 15, lengthMenu: [15,25,50,100], dom:'Bfrtip', buttons:['pageLength','copy','csv'],
        rowId: (d) => d.search_term.replace(/ /g, '_')
      });
    });
  </script>
</body>
</html>
